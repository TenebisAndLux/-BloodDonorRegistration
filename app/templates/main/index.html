<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система учета доноров крови</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list_styles.css') }}">
</head>
<body>
<div class="header">
    <div class="hospital-name">Больница имени Н.И. Пирогова</div>
    <div class="name-container" onmouseenter="showLogoutButton()" onmouseleave="hideLogoutButton()">
        <div class="name" onfocus="showLogoutButton()">
            Иванов И.И.
        </div>
        <div class="exit-button" style="display: none" onmouseenter="showLogoutButton()"
             onmouseleave="hideLogoutButton()" onclick="location.href='/login'">Выход
        </div>
    </div>
</div>
<script src="{{ url_for('static', filename='js/index_scripts.js') }}"></script>
<div class="search-container">
    <form action="/search" method="post">
        <table>
            <tr>
                <th><label for="surname">Фамилия:</label></th>
                <td><input type="text" id="surname" name="surname" required></td>
                <th><label for="street">Улица:</label></th>
                <td><input type="text" id="street" name="street" required></td>
                <th><label for="blood">Группа крови:</label></th>
                <td><input type="text" id="blood" name="blood" required></td>
            </tr>
            <tr>
                <th><label for="name">Имя:</label></th>
                <td><input type="text" id="name" name="name" required></td>
                <th><label for="house">Дом:</label></th>
                <td><input type="text" id="house" name="house" required></td>
                <th><label for="rh">Резус Фактор:</label></th>
                <td><input type="text" id="rh" name="rh" required></td>
            </tr>
            <tr>
                <th><label for="patronymic">Отчество:</label></th>
                <td><input type="text" id="patronymic" name="patronymic" required></td>
                <th><label for="blood_bank_registration_number">СНИЛС:</label></th>
                <td><input type="text" id="blood_bank_registration_number" name="blood_bank_registration_number"
                           required></td>
                <th><label for="birth_date">Д/Р:</label></th>
                <td><input type="date" id="birth_date" name="birth_date" required></td>
            </tr>
            <tr>
                <td colspan="6" style="text-align: right;">
                    <button type="reset">Очистить</button>
                    <button type="submit">Найти</button>
                </td>
            </tr>
        </table>
    </form>
</div>

<div class="action-buttons">
    <button onclick="addDonorModal()">Записать</button>
    <button onclick="openModal()">Редактировать данные</button>
    <button onclick="requestBlood()">Запросить кровь</button>
</div>

<!-- Модальное окно для добавления нового донора -->
<div id="addDonorModal" class="modal-add">
    <div class="modal-add-content">
        <span class="close" onclick="closeAddModal()">&times;</span>
        <form id="addDonorForm">
            <table>
                <tr>
                    <th><label for="addDonorFirstName">Имя:</label></th>
                    <td><input type="text" id="addDonorFirstName" name="addDonorFirstName" required></td>
                    <th><label for="addDonorLastName">Фамилия:</label></th>
                    <td><input type="text" id="addDonorLastName" name="addDonorLastName" required></td>
                    <th><label for="addDonorMiddleName">Отчество:</label></th>
                    <td><input type="text" id="addDonorMiddleName" name="addDonorMiddleName"></td>
                </tr>
                <tr>
                    <th><label for="addDonorDateOfBirth">Д/Р:</label></th>
                    <td><input type="date" id="addDonorDateOfBirth" name="addDonorDateOfBirth" required></td>
                    <th><label for="addDonorGender">Пол:</label></th>
                    <td><select id="addDonorGender" name="addDonorGender" required>
                            <option value="Мужской">Мужской</option>
                            <option value="Женский">Женский</option>
                        </select></td>
                    <th><label for="addDonorAddress">Адрес:</label></th>
                    <td><input type="text" id="addDonorAddress" name="addDonorAddress"></td>
                </tr>
                <tr>
                    <th><label for="addDonorPhoneNumber">Телефон:</label></th>
                    <td><input type="text" id="addDonorPhoneNumber" name="addDonorPhoneNumber"></td>
                    <th><label for="addDonorHospitalAffiliation">Прикрепление:</label></th>
                    <td><input type="text" id="addDonorHospitalAffiliation" name="addDonorHospitalAffiliation"></td>
                    <th><label for="addDonorPassportData">Паспорт:</label></th>
                    <td><input type="text" id="addDonorPassportData" name="addDonorPassportData"></td>
                </tr>
                <tr>
                    <th><label for="addDonorInsuranceData">Страховка:</label></th>
                    <td><input type="text" id="addDonorInsuranceData" name="addDonorInsuranceData"></td>
                    <th><label for="addDonorBloodType">Группа крови:</label></th>
                    <td><input type="text" id="addDonorBloodType" name="addDonorBloodType" required></td>
                    <th><label for="addDonorRhFactor">Резус-фактор:</label></th>
                    <td><input type="text" id="addDonorRhFactor" name="addDonorRhFactor" required></td>
                </tr>
            </table>
            <div class="modal-add-action-buttons">
                <button type="submit" onclick="addDonor()">Записать</button>
            </div>
        </form>
    </div>
</div>
<script>
// Открывает модальное окно
function addDonorModal() {
    document.getElementById('addDonorModal').style.display = 'block';
}

// Закрывает модальное окно
function closeAddModal() {
    document.getElementById('addDonorModal').style.display = 'none';
}

async function addDonor() {
    const form = document.getElementById('addDonorForm');
    const formData = new FormData(form);
    try {
        const response = await fetch('/donor/add', {
            method: 'POST',
            body: formData
        });
        if (response.ok) {
            alert('Донор успешно добавлен.');
            window.location.reload();
        } else {
            throw new Error('Ошибка при добавлении донора.');
        }
    } catch (error) {
        alert(error.message);
    }
}
</script>

<!-- Модальное окно для редактирования данных донора -->
<div id="editDonorModal" class="modal-edit">
    <div class="modal-edit-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <form id="editDonorForm">
            <table>
                <tr>
                    <th><label for="editDonorFirstName">Имя:</label></th>
                    <td><input type="text" id="editDonorFirstName" name="editDonorFirstName" required></td>
                    <th><label for="editDonorLastName">Фамилия:</label></th>
                    <td><input type="text" id="editDonorLastName" name="editDonorLastName" required></td>
                    <th><label for="editDonorMiddleName">Отчество:</label></th>
                    <td><input type="text" id="editDonorMiddleName" name="editDonorMiddleName"></td>
                </tr>
                <tr>
                    <th><label for="editDonorDateOfBirth">Д/Р:</label></th>
                    <td><input type="date" id="editDonorDateOfBirth" name="editDonorDateOfBirth" required></td>
                    <th><label for="editDonorGender">Пол:</label></th>
                    <td><select id="editDonorGender" name="editDonorGender" required>
                            <option value="Мужской">Мужской</option>
                            <option value="Женский">Женский</option>
                        </select></td>
                    <th><label for="editDonorAddress">Адрес:</label></th>
                    <td><input type="text" id="editDonorAddress" name="editDonorAddress"></td>
                </tr>
                <tr>
                    <th><label for="editDonorPhoneNumber">Телефон:</label></th>
                    <td><input type="text" id="editDonorPhoneNumber" name="editDonorPhoneNumber"></td>
                    <th><label for="editDonorHospitalAffiliation">Прикрепление:</label></th>
                    <td><input type="text" id="editDonorHospitalAffiliation" name="editDonorHospitalAffiliation"></td>
                    <th><label for="editDonorPassportData">Паспорт:</label></th>
                    <td><input type="text" id="editDonorPassportData" name="editDonorPassportData"></td>
                </tr>
                <tr>
                    <th><label for="editDonorInsuranceData">Страховка:</label></th>
                    <td><input type="text" id="editDonorInsuranceData" name="editDonorInsuranceData"></td>
                    <th><label for="editDonorBloodType">Группа крови:</label></th>
                    <td><input type="text" id="editDonorBloodType" name="editDonorBloodType" required></td>
                    <th><label for="editDonorRhFactor">Резус-фактор:</label></th>
                    <td><input type="text" id="editDonorRhFactor" name="editDonorRhFactor" required></td>
                </tr>
            </table>
            <div class="modal-edit-action-buttons">
                <button type="submit">Редактировать данные</button>
            </div>
        </form>
    </div>
</div>
<script>
// Открывает модальное окно
function openModal() {
    document.getElementById('editDonorModal').style.display = 'block';
}

// Закрывает модальное окно
function closeEditModal() {
    document.getElementById('editDonorModal').style.display = 'none';
}

document.getElementById('editDonorForm').addEventListener('submit', function(event) {
    event.preventDefault();
    // Добавьте ваш код для обработки редактирования данных здесь
});
</script>


<table class="donors-list">
    <thead>
    <tr>
        <th>Амб.карта</th>
        <th>ФИО</th>
        <th>Д/Р</th>
        <th>Прикрепление</th>
        <th>Полис</th>
        <th>Группа крови</th>
        <th>Ресус-фактор</th>
        <th>Дата последней сдачи крови</th>
        <th>Возможность повторного взятия крови</th>
    </tr>
    </thead>
    <tbody id="donors">
    </tbody>
</table>

<table class="donors-list-history">
    <thead>
    <tr>
        <th colspan="6">История и записи</th>
    </tr>
    <tr>
        <th>Амб.карта</th>
        <th>ФИО</th>
        <th>Д/Р</th>
        <th>Прикрепление</th>
        <th>Полис</th>
        <th>Дата последнего изменения</th>
    </tr>
    </thead>
    <tbody id="donors-history">
    </tbody>
</table>

<div class="save-load-buttons">
    <button onclick="saveDonors()">Сохранить</button>
    <button onclick="loadCSV()">Загрузить</button>
    <input type="file" id="file" onchange="uploadCSV()">
</div>

<div class="footer">
    <span>Разработка и поддержка - ООО "DONOR MIRROR"</span>
</div>

<script src="scripts.js"></script>
</body>

</html>

